<?xml version="1.0" encoding="UTF-8"?>
<Module>
    <ModulePrefs
            title="Siebel Contacts"
            author="Vivek Srinivasan"
            author_email="vivek.athrey@gmail.com" height="100">
        <Require feature="views" />
        <Require feature="dynamic-height" />
    </ModulePrefs>
    <Content type="html"><![CDATA[
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript">
		var contactsService;
		
		function setupContactsService() {
		  contactsService = new google.gdata.contacts.ContactsService('exampleCo-exampleApp-1.0');
		}
		
		function logMeIn() {
		  var scope = 'https://www.google.com/m8/feeds';
		  var token = google.accounts.user.login(scope);
		}
		
		function initSiebelContactsGadget() {
		  google.load("gdata", "2.x");
		  alert('Google Library Loaded');
		  setupContactsService();
		  alert('Contact Service Setup');
		  logMeIn();
		  getMyContacts();
		}

		function getMyContacts() {
		  var contactsFeedUri = 'https://www.google.com/m8/feeds/contacts/default/full';
		  var query = new google.gdata.contacts.ContactQuery(contactsFeedUri);
		  
		  // Set the maximum of the result set to be 5
		  query.setMaxResults(5);
		  
		  contactsService.getContactFeed(query, handleContactsFeed, handleError);
		}
		
		var handleContactsFeed = function(result) {
		  var entries = result.feed.entry;
		
		  for (var i = 0; i < entries.length; i++) {
		    var contactEntry = entries[i];
		    var emailAddresses = contactEntry.getEmailAddresses();
		    
		    for (var j = 0; j < emailAddresses.length; j++) {
		      var emailAddress = emailAddresses[j].getAddress();
		      alert('email = ' + emailAddress);
		    }    
		  }
		}		
   gadgets.util.registerOnLoadHandler(initSiebelContactsGadget);
   
 </script>]]>
 </Content>
</Module>
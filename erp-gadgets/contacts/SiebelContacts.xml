<?xml version="1.0" encoding="UTF-8"?>
<Module>
    <ModulePrefs
            title="Siebel Contacts"
            author="Vivek Srinivasan"
            author_email="vivek.athrey@gmail.com" height="100">
        <Require feature="views" />
        <Require feature="dynamic-height" />
		<OAuth>
		  <Service name="google">
		    <Access url="https://www.google.com/accounts/OAuthGetAccessToken" method="GET" /> 
		    <Request url="https://www.google.com/accounts/OAuthGetRequestToken?scope=http://www.google.com/m8/feeds/" method="GET" /> 
		    <Authorization url="https://www.google.com/accounts/OAuthAuthorizeToken?oauth_callback=http://oauth.gmodules.com/gadgets/oauthcallback" /> 
		  </Service>
		</OAuth>        
    </ModulePrefs>
    <Content type="html"><![CDATA[
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript">
   var contactsService = null;
   function initFunc(){
    alert('Library loaded');
   } 
   function initSiebelContactsGadget()
   {
    google.load("gdata", "2.x");	
    google.setOnLoadCallback(initFunc);	
    contactsService =	    new google.gdata.contacts.ContactsService('SiebelApp');
    contactsService.useOAuth("google");
    alert('Service Authorization');
    syncContactsData();
   }
  
   
   function logMeIn()
   {
    var scope = 'https://www.google.com/m8/feeds';
    var token = google.accounts.user.login(scope);
   }
     
   
	function syncContactsData() {
	 alert('Get Data Fired');
	  var params = {};
	  params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.TEXT;
	  var url = "http://code.google.com/securedataconnector/docs/tutorials/contacts.csv";
	  gadgets.io.makeRequest(url, function(response){log(response);}, params);
	}

	  // Callback function to process the response
	function log(response) {        
	alert('Response Call Back');       
	    var responseText = obj.text;  
	// Set CSS for div.
	/*
	 * Create a contact entry
	 */ 
	

	alert('Response Call Back 2');  
	
	
	 	
	// The feed URI that is used to create a contact entry
	var feedUri = 'http://www.google.com/m8/feeds/contacts/default/full';
	
	// Create an instance of ContactEntry
	var entry = new google.gdata.contacts.ContactEntry();
	
	// Set the name of the contact
	entry.setTitle(google.gdata.Text.create('Vivek Srinivasan'));
	
	// Set the content of the contact
	entry.setContent(google.gdata.Text.create('Test'));
	
	// Create an email instance
	var email = new google.gdata.Email();
	email.setAddress('JS-Client@domain.com');
	email.setPrimary(true);
	// Designate this email as the "home" email
	email.setRel(google.gdata.Email.REL_HOME);
	
	// Add the email instance
	entry.setEmailAddresses([email]);
	
		alert('Setting Email');  
	
	// The callback method that will be called after a successful insertion from insertEntry()
	var callback = function(result) {
	  PRINT('contact entry created!');
	  alert('Contact Created');
	}
	
	// Error handler will be invoked if there is an error from insertEntry()
	var handleError = function(error) {
	  PRINT(error);
	   alert('Contact Creation Failed'); 
	}
	
	// Submit the request using the contacts service object
	contactsService.insertEntry(feedUri, entry, callback, 
	    handleError, google.gdata.contacts.ContactEntry);
	   
	   alert('Contct Service Invoked');
	    
	}
   gadgets.util.registerOnLoadHandler(initSiebelContactsGadget);
   
 </script>]]>
 </Content>
</Module>
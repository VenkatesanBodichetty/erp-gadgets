<?xml version="1.0" encoding="UTF-8"?>
<Module>
    <ModulePrefs
            title="Siebel Contacts"
            author="Vivek Srinivasan"
            author_email="vivek.athrey@gmail.com" height="100">
        <Require feature="views" />
        <Require feature="dynamic-height" />
		<OAuth>
		  <Service name="google">
		    <Access url="https://www.google.com/accounts/OAuthGetAccessToken" method="GET" /> 
		    <Request url="https://www.google.com/accounts/OAuthGetRequestToken?scope=http://www.google.com/m8/feeds/" method="GET" /> 
		    <Authorization url="https://www.google.com/accounts/OAuthAuthorizeToken?oauth_callback=http://oauth.gmodules.com/gadgets/oauthcallback" /> 
		  </Service>
		</OAuth>        
    </ModulePrefs>
    <Content type="html"><![CDATA[
  <script type="text/javascript" src="http://www.google.com/jsapi"></script>
  <script type="text/javascript">
		var contactsService;
		
		function setupContactsService() {
		  alert('Library Loaded');
		  contactsService = new google.gdata.contacts.ContactsService("VividEdge-SiebelContactApp-1.0");
		  contactsService.useOAuth("google");
		}
		
		function initSiebelContactsGadget() {
		  google.load("gdata","2.x");
		  google.setOnLoadCallback(setupContactsService);
		    alert('Library Loaded');
		    getMySiebelContacts();	
		   alert('Library Loaded 2'); 	    
		}

		function getMySiebelContacts() {
			var callback = function(response) {
			  if (response.oauthApprovalUrl) {
			  
				var popup = shindig.oauth.popup({
				      destination: response.oauthApprovalUrl,
				      windowOptions: 'height=600,width=800',
				      onOpen: function() {
				        showOnly('waiting');
				      },
				      onClose: function() {
				        showOnly('loading');
				        getMySiebelContacts();
				      }
				    });
				    jQuery('#personalize').get(0).onclick = popup.createOpenerOnClick();
				    jQuery('#approvalLink').get(0).onclick = popup.createApprovedOnClick();
				    
				    showOnly('approval'); 
			    
				} else if (response.feed) {
				  showResults(response);
				  showOnly('main');
				} else {
				  jQuery('#errors').html('Something went wrong').fadeIn();
				  showOnly('errors');
				}
			};		
		  contactsService.getContactFeed(contactsFeedUri, callback, callback);
		}
   gadgets.util.registerOnLoadHandler(initSiebelContactsGadget);
   
 </script>]]>
 </Content>
</Module>